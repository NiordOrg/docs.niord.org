
:imagesdir: images

== Editor

The _Editor_ page of Niord is accessible for logged in editors via the main menu.

It contains sub-pages for creating and editing NW and NM messages, for managing the lifecycle
of the messages and for submitting comments to a message.

image::Editor.png[Editor, 800]


=== Blank Editor Page ===

If the user enters the _Editor_ page directly (as opposed to clicking _Edit_ on a message),
the _Edit_ page looks similar to this:

image::BlankEditorPage.png[Blank Editor Page, 600]

If the current domain supports Navigational Warnings, there will be a prominent "New NW" button
for creating a new blank NW message.

Similarly, if the current domain supports Notices to Mariners, there will be a prominent
"New NM" button for creating a new blank NM message.

Depending on how the current domain has been set up administratively, there may also be a
_template execution field_. Navigational Warnings in particular often follow a very strict
template for how to write the messages so that they adhere to the standards for MSI, NAVTEX, etc.
The field thus allows the user to select and execute a template, such as "Light Unlit".
Message Templates is an extensive topic, covered in greater detail in the
<<Message Template Execution>> section.

Lastly, the blank editor page will list the draft messages that the current user has
recently edited.

=== Edit Editor Page ===

When the user has created a new NW or NM message, as described in the previous section, or if
the user clicks _Edit_ on an existing message, the user will enter the _Edit_ editor sub-page,
which is the main page for actually editing the fields of a message.
See image in the beginning of the <<Editor>> chapter.

==== General Edit Page Controls ====

If the user enters the _Edit_ editor page by clicking _Edit_ on a message in the messages list,
there will be a "Back to list" button that will return the user to the _Messages_ page with
the same message filter applied as when entering the _Edit_ page.

The "Clear" button will cancel all changes and return the user to the <<Blank Editor Page>>.

If the currently edited message has any unsaved changes, there will be a red _Save_ icon
next to the "Editor" title:

image::EditorDirty.png[Dirty Editor Symbol, 100]

At the bottom of the page, there is a "Save Message" button and a "Reload Message" button, which
will respectively save any changes to the message and reload the message whilst discarding any changes.

The rest of the _Edit_ page is dedicated to the list of field editors for all the fields
that make the message being edited.

The list of fields is configured administratively per domain and message type. As an example,
Notices to Mariners will support fields such as "original information", whereas Navigational Warnings
may have a field for editing its NAVTEX promulgation.

In order to conserve space, all editor fields are "collapsed" by default, showing a read-only
version of the field value in the currently selected language.
However, clicking at the field title will expand the field and display the field editor in full.
See example below withe the _Areas_ editor field in collapsed and expanded mode:

image::EditorFieldAreasCollapsed.png[Areas Editor Field Collapsed, 180]
image::EditorFieldAreas.png[Areas Editor Field Expanded, 600]

The editor has extensive support for keyboard navigation. The user can use the arrow-up and
arrow-down key to shift focus from field title to field title. Use arrow-right to expand the
editor field currently selected, and arrow-left to collapse the field.
Use tab, respectively shift-tab, to shift focus between the input fields of a field editor.

The remainder of this section will describe the individual editor fields one by one.

==== Orig. Information Editor Field ====

image::EditorFieldOrigInfo.png[Orig. Information Editor Field, 600]

The _Orig. Information_ editor field is typically only present when editing a Notice to Mariners.
The editor field contains a toggle-button that can be used to flag if the message is based on
original information or not.

==== Type Editor Field ====

image::EditorFieldType.png[Type Editor Field, 600]

The _Type_ editor field allows the user specify the sub-type of the message.

For Navigational Warnings, the types include _Local_, _Coastal_,
_Subarea_ and _Navarea_. Depending on the system configuration of the domain, only a subset
of these types may be available.

For Notices to Mariners, the types include _Preliminary_, _Temporary_,
_Permanent_ and _Miscellaneous_. Depending on the system configuration of the domain, only a subset
of these types may be available.

==== ID Editor Field ====

image::EditorFieldId.png[ID Editor Field, 600]

All messages must be associated with a _message series_, which are defined administratively for
each domain.
The message series are used to group messages and define traits such as the format of the message
_short ID_, and the numbering scheme. There are four possible types of numbering schemes:

[cols="30,70",options="header"]
|===
|Numbering Scheme|Description

|yearly|Every message will automatically be assigned a number when they are published.
The number sequence starts at 1 every 1st of january.

|continuous|Every message will automatically be assigned a number when they are published.
The number sequence is never reset.

|manual|The user manually assigns a number in the _ID_ editor field.

|none|The message will not be assigned a number.

|===


The _ID_ editor field lets lets the user select any of the available message series for the
current domain and message type. Often there will only be one to select from, in which case,
it will be pre-selected.

If the numbering scheme of the selected message series is _manual_, the _ID_ editor field
will also have an input field for the user to fill out the message number.

Lastly, all messages will automatically be assigned a unique system ID, or _UID_, upon creation,
which can also be found in the _ID_ editor field.
Although the UID is not very end-user friendly, it can be used to uniquely identify messages even
before they are published.

==== Title Editor Field ====

image::EditorFieldTitle.png[Title Editor Field, 600]

The _Title_ editor field allows the user to specify the main title of the message in all supported
languages.

By default, the "Auto generate" option is checked, in which case the title fields are disabled
and computed automatically, by concatenating the currently selected _areas_, _vicinity_ and
the _subject_ fields of each message parts.

==== References Editor Field ====

image::EditorFieldReferences.png[References Editor Field, 600]

The _References_ editor field allows the user to manage a list of typed references from the edited
message to other messages. It is mainly used for Notices to Mariners, but could also e.g. be used
for cancellation references in navigational warnings.

Each reference must specify a _message ID_ which may either be the _short ID_ or the _UID_ of the
referenced message.

The reference type is one of _reference_, _repetition_, _repetition_with_new_time_,
_updated_repetition_, _cancelled_, and signals the nature of the relationship between the
messages.

Additionally, the user may add a reference description in all supported languages.

In end-user applications, references can e.g. be used to hyperlink between messages.

==== Publish Date Editor Field ====

image::EditorFieldPublishDate.png[Publish Date Editor Field, 600]

Messages can either be scheduled for publication, or published and cancelled manually
via the <<Status Editor Page>>.

The _Publish Date_ editor field can be used for assigning a _publish from_ and/or a
_publish to_ date.
If a message has the _Verified_ status, the system will automatically publish the message when the
_publish from_ date is reached. Similarly, if the _publish to_ date is specified for a published
message, the system will automatically expire the message when that date is reached.

The user can also specify a _follow-up date_ in the _Publish Date_ editor field. The _follow up_ date
can be displayed and sorted by on the <<Messages>> page.

==== Areas Editor Field ====

image::EditorFieldAreas.png[Areas Editor Field, 600]

The _Areas_ editor field can be used to assign one or more areas to a message. The areas to select
from are created and managed by administrators in a hierarchical structure.
So, as an example, the firing area "EK D 371 Marstal Bugt" is a sub-area of "The Baltic Sea", which
is in turn a sub-area of "Denmark".

Selecting an area in the _Areas_ editor field will also implicitly select all parent areas.

In addition to the main area input field, the user can also specify a _vicinity_ in all supported
languages. This is used for the specific location of the hazard (such as a harbour name).

If the selected area has an associated geometry, the "Copy Locations" button will copy that
geometry into the <<Positions Editor Field>> of the message.

Alternatively, if no area has been selected but a geometry has been defined for the message, then
clicking the "Compute from Locations" will attempt to deduce the area from the geometry.

==== Categories Editor Field ====

image::EditorFieldCategories.png[Categories Editor Field, 600]

The _Categories_ editor field can be used to assign one or more categories to a message.
The categories to select from are created and managed by system administrators in a
hierarchical structure.

Some categories have been defined as executable _message templates_. If one or more of these
categories have been selected, the image:ExecuteTemplateBtn.png[Tag, 16] will be enabled and
allow for execution.

Navigational Warnings in particular often follow a very strict
template for how to write the messages so that they adhere to the standards for MSI, NAVTEX, etc.
The field thus allows the user to select and execute a template, such as "Light Unlit".
Message Templates is an extensive topic, covered in greater detail in the
<<Message Template Execution>> section.

==== Message Parts ====

A message consists of a set of common _preamble_ fields and a list of _Message Parts_,
where each message part conceptually defines the time, place and description of a hazard.

The option for one message to describe multiple message parts is mostly used by Notices to Mariners,
not so much Navigational Warnings, which typically only define a single message part each.

Each message part is enclosed by a message part header panel:

image::MessagePartType.png[Message Part Type, 600]

Clicking the plus sign will add a new message part below, and clicking the minus sign will delete
the given message part. If more than one message parts are present, there will also be arrow-up and
arrow-down buttons in the message part header panel, which may be used to re-organize the message
parts.


=== Status Editor Page ===

TBD

=== Comments Editor Page ===

TBD

=== History Editor Page ===

TBD

=== Editor Actions ===

TBD

=== Message Template Execution ===

TBD
