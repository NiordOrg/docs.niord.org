<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<title>Niord System Development Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/*! Stylesheet for CodeRay to loosely match GitHub themes | MIT License */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid;opacity:.35;padding:0 .5em 0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff!important;background:navy!important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:navy}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:teal}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:teal}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:teal}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword{color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:teal}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Niord System Development Guide</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">1. Introduction</a></li>
<li><a href="#java-coding-conventions">2. Java Coding Conventions</a></li>
<li><a href="#webapp-coding-conventions">3. Webapp Coding Conventions</a></li>
<li><a href="#niord-development-set-up">4. Niord Development Set-Up</a></li>
<li><a href="#niord-proxy-development-set-up">5. Niord-Proxy Development Set-Up</a></li>
<li><a href="#niord-docker-containers">6. Niord Docker Containers</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a><a class="link" href="#introduction">1. Introduction</a></h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>This version of the development guideline is for Niord 2.0 which is no longer under development. Niord 3.0 is the current version, where Wildfly has been replaced by Quarkus.*</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Niord (Nautical Information Directory) is a system for producing and publishing
Navigational Warnings (<em>NW</em>) and Notices to Mariners T&amp;P (<em>NM</em>).</p>
</div>
<div class="paragraph">
<p>It was originally developed as part of the <a href="http://efficiensea2.org">EfficienSea2</a> EU project
and subsequently implemented as a production system for the
<a href="http://www.dma.dk/">Danish Maritime Authority</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/EfficienSea2.png" alt="EfficienSea2" width="200">
</div>
</div>
<div class="paragraph">
<p>This guide should be read by developers of Niord. It will use the Danish Niord system as a use case.
The guide will cover topics, such as coding conventions, how to set up a development environment, etc.</p>
</div>
<div class="sect2">
<h3 id="developer-profile"><a class="anchor" href="#developer-profile"></a><a class="link" href="#developer-profile">1.1. Developer Profile</a></h3>
<div class="paragraph">
<p>For the development process to be effective, the developer sshould preferably have a thorough knowledge
of the following technologies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java 8</p>
</li>
<li>
<p>Java EE 7: Niord uses the entire Java EE 7 stack, specially EJB, JPA, JAX-RS, Servlets, Batch API,
CDI, etc.</p>
</li>
<li>
<p>AngularJS + Bootstrap</p>
</li>
<li>
<p>MySQL</p>
</li>
<li>
<p>Docker</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It would also be advantageous, if the developer has some knowledge of the following technologies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OpenLayers</p>
</li>
<li>
<p>Wildfly 10</p>
</li>
<li>
<p>JBOSS Keycloak</p>
</li>
<li>
<p>Freemarker</p>
</li>
<li>
<p>Maven</p>
</li>
<li>
<p>Git(hub)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Furthermore, the actual Niord source code also has a certain learning curve.</p>
</div>
</div>
<div class="sect2">
<h3 id="resources"><a class="anchor" href="#resources"></a><a class="link" href="#resources">1.2. Resources</a></h3>
<div class="paragraph">
<p>The main GitHub repository for Niord is found at <a href="https://github.com/niordorg" class="bare">https://github.com/niordorg</a>.
For the developer, the main projects of the repository are.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Projects</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/NiordOrg/niord">niord</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Main project for the Niord production system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/NiordOrg/niord-dk">niord-dk</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extensions for the Danish Niord production system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/NiordOrg/niord-proxy">niord-proxy</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Simple end-user facing website that displays
the active messages from the Niord production system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/GhanaNauticalnfo/niord-gh">niord-gh</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extensions for the Ghanaian Niord production
system (NB: separate repo).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/NiordOrg/niord-appsrv">niord-appsrv</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resources for installing and configuring the
middleware used by the Niord production system, i.e. MySQL, Wildfly and Keycloak.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/NiordOrg/niord-docker">niord-docker</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scripts and configuration files for creating
and pushing all Docker-containers needed for running a Niord production system.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="java-coding-conventions"><a class="anchor" href="#java-coding-conventions"></a><a class="link" href="#java-coding-conventions">2. Java Coding Conventions</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Niord is fairly consistent about using naming and coding conventions, and understanding these conventions
makes it easier to read the code.</p>
</div>
<div class="paragraph">
<p>Each <em>logical entity</em> of Niord, such as an <em>area</em>, a <em>chart</em>, a <em>message</em> or a <em>publication</em>, is
implemented using JPA entities, JSON-serializable value objects, business logic, REST interfaces, and
batch import classes.</p>
</div>
<div class="sect2">
<h3 id="area-example"><a class="anchor" href="#area-example"></a><a class="link" href="#area-example">2.1. Area Example</a></h3>
<div class="paragraph">
<p>As an example, consider the <em>Area</em> entity, which represents a specific area in the Areas tree. The classes used
to implement areas, can be seen below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/PackageStructure.png" alt="Package Structure" width="300">
</div>
</div>
<div class="paragraph">
<p>The classes are spread across three niord sub-projects:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Projects</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/NiordOrg/niord/tree/master/niord-model">niord-model</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the <a href="../model/model.html">Niord Message Model</a>. The message model is made up of
  value objects.<br>
  Third-party application can define a dependency on this project if they integrate with Niord via
  the <a href="../public-api/api.html">Public REST API</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/NiordOrg/niord/tree/master/niord-core">niord-core</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the actual entity classes and business logic (session beans).<br>
  May also define system model value objects, in as much as these may extend the niord-model classes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/NiordOrg/niord/tree/master/niord-web">niord-web</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the JAX-RS REST interface used by clients (such as the Niord web application) to access the
  entities and execute business logic.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="classes-and-naming-conventions"><a class="anchor" href="#classes-and-naming-conventions"></a><a class="link" href="#classes-and-naming-conventions">2.1.1. Classes and Naming Conventions</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Classes</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AreaVo</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <a href="../model/model.html">Niord Message Model</a> representation of an area.<br>
  The <code>Vo</code> suffix is used for all <em>value objects</em>, which are essentially JSON-serializable
  versions of the real entities.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AreaDescVo</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains a language code and all localizable attributes of <code>AreaVo</code>.
  These associated entities have a <code>Desc</code> suffix, as in <code>AreaDescVo</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Area</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The JPA entity definition of an area.<br>
  Whereas there will be a strong correlation between the attributes of the <code>Area</code> entity and the <code>AreaVo</code>
  value object, the entity class may define additional attributes, which are not part of the
  public niord-model class. The entity class thus constitutes a <em>system model</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AreaDesc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The JPA entity definition of the area description entity, i.e. the localizable attributes of an area.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SystemAreaVo</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When a <em>system model</em> entity, such as <code>Area</code>, contains attributes not included in the value objects
  of the <a href="../model/model.html">Niord Message Model</a>, then a value object with a <code>System</code> prefix
  is introduced to capture the additional attributes.<br>
  As such, <code>SystemAreaVo</code> will extend <code>AreaVo</code> and includes the additional attributes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AreaService</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Each entity will have a companion stateless session bean or singleton EJB, with a <code>Service</code> suffix.
  This class defines the business logic and life-cycle management functions of the entity.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BatchAreaImportReader</code><br>
  <code>BatchAreaImportProcessor</code><br>
  <code>BatchAreaImportWriter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Many of the Niord model entities have an associated batch job for importing the entities.<br>
  The batch job is typically implemented using the Java EE batch API, and the three phases
  will be implemented by classes that have a <code>Batch</code> prefix and the <code>Reader</code>, <code>Processor</code> and <code>Writer</code>
  suffixes respectively.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AreaRestService</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Each Niord entity will also be associated with a JAX-RS REST interface.<br>
  This interface is typically a thin wrapper on top of the service interface, and will have the
  <code>RestService</code> suffix.<br>
  The REST interface also performs all the security and permission checks used to protect the
  Niord system.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="localization"><a class="anchor" href="#localization"></a><a class="link" href="#localization">2.2. Localization</a></h3>
<div class="paragraph">
<p>Almost all entities in Niord are localizable to any number of languages.<br>
As can be seen from the <a href="../model/model.html">Niord Message Model</a>, this is implemented by
associating an entity with a list of classes that contain a language code
and all localizable attributes.</p>
</div>
<div class="paragraph">
<p>Area contains one localizable attributes; <em>name</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">AreaVo</span> <span class="directive">implements</span> ILocalizable&lt;AreaDescVo&gt;, IJsonSerializable {
    <span class="predefined-type">List</span>&lt;AreaDescVo&gt; descs;
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">AreaDescVo</span> <span class="directive">implements</span> ILocalizedDesc, IJsonSerializable {
    <span class="predefined-type">String</span> lang;
    <span class="predefined-type">String</span> name;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serialization-and-de-serialization"><a class="anchor" href="#serialization-and-de-serialization"></a><a class="link" href="#serialization-and-de-serialization">2.3. Serialization and De-serialization</a></h3>
<div class="paragraph">
<p>All Niord entities have methods for converting to and fro their <em>value object</em> representation.</p>
</div>
<div class="paragraph">
<p>In the simplest form, the JPA entity model will define a constructor that takes the <em>value object</em>
representation as a parameter, and it will have a <code>toVo()</code> function that returns the <em>value object</em>
representation of the entity. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Domain</span> <span class="directive">extends</span> BaseEntity&lt;<span class="predefined-type">Integer</span>&gt; {
    <span class="directive">public</span> Domain() {}
    <span class="directive">public</span> Domain(DomainVo domain) {
        <span class="comment">// Instantiate entity from value object</span>
    }
    <span class="directive">public</span> DomainVo toVo() {
        <span class="comment">// instantiate and return a value object from entity</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sometimes, however, things are a little more complex, as is the case for <code>Area</code>.</p>
</div>
<div class="paragraph">
<p><code>Area</code> has two <em>value object</em> representations, <code>AreaVo</code> and <code>SystemAreaVo</code>.
When, say, a public REST API call returns a message with an associated area, then the <code>AreaVo</code> should be
returned. If, however, a system administrator edits an area via the Niord webapp, then the <code>SystemAreaVo</code>
representation should be used.<br>
So, <code>Area.toVo()</code> actually takes the target value object class as a parameter, and leave it to the
REST service to decide which representation to use.</p>
</div>
<div class="paragraph">
<p>Another complexity in serializing an entity to its <em>value object</em>, is that often you wish to exact
control over which fields to return.<br>
One example is language control. Most of the REST API calls will only return the localizable entities
(e.g. <code>AreaDescVo</code>) for the requested language. This preserves bandwidth and makes client code simpler.<br>
Another good example is control over the hierarchical relationship of Areas.
When a message with an associated area (say, "Kattegat") is returned from a REST call, then you want
the <em>parent</em> relationship of areas to be included ("Kattegat" should include a parent-reference
to "Denmark). Alternatively, when editing the area tree on the <em>Areas</em> admin page, then you want
the REST call to return root areas with their <em>children</em> relationship.</p>
</div>
<div class="paragraph">
<p>To facilitate this type of serialization control, Niord use a <code>DataFilter</code> helper class, which
defines the fields and language to include. To control the serialization of an entire tree of
related entities, the fields can be prefixed with the entity name, as seen in the example below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">DataFilter filter = DataFilter.get()
    .fields(<span class="string"><span class="delimiter">&quot;</span><span class="content">Message.details</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Message.geometry</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Area.parent</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Category.parent</span><span class="delimiter">&quot;</span></span>)
    .lang(<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hence, the resulting serialization code for <code>Area</code> will thus be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Area</span> <span class="directive">extends</span> TreeBaseEntity&lt;<span class="predefined-type">Area</span>&gt; <span class="directive">implements</span> ILocalizable&lt;AreaDesc&gt; {
    <span class="directive">public</span> <span class="predefined-type">Area</span>() {}
    <span class="directive">public</span> <span class="predefined-type">Area</span>(AreaVo area, DataFilter filter) {
        <span class="comment">// Instantiate entity from value object</span>
    }
    <span class="directive">public</span> &lt;A <span class="directive">extends</span> AreaVo&gt; A toVo(<span class="predefined-type">Class</span>&lt;A&gt; clz, DataFilter filter) {
        <span class="comment">// instantiate and return a value object from entity</span>
    }
}</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="webapp-coding-conventions"><a class="anchor" href="#webapp-coding-conventions"></a><a class="link" href="#webapp-coding-conventions">3. Webapp Coding Conventions</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The other big chunk of code in Niord is the AngularJS and JavaScript-based web application.</p>
</div>
<div class="sect2">
<h3 id="organization-of-angular-sources"><a class="anchor" href="#organization-of-angular-sources"></a><a class="link" href="#organization-of-angular-sources">3.1. Organization of Angular Sources</a></h3>
<div class="paragraph">
<p>The web application is organized as follows:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/WebAppStructure.png" alt="Package Structure" width="240">
</div>
</div>
<div class="paragraph">
<p>All source files developed as part of Niord, is placed in the <em>app</em> folder.
All external dependencies, such as third-party AngularJS directives, are placed in the <em>ext</em> folder.</p>
</div>
<div class="paragraph">
<p>Under <em>app</em>, the angular sources, such as directives, controllers, services and partials (html),
are primarily organized by <em>main page</em>.
So, all sources for the <em>Messages</em> page are in the <em>messages</em> folder, etc.</p>
</div>
</div>
<div class="sect2">
<h3 id="application-cache"><a class="anchor" href="#application-cache"></a><a class="link" href="#application-cache">3.2. Application Cache</a></h3>
<div class="paragraph">
<p>The Niord web application use various HTML 5 features, such as <em>Local Storage</em> and <em>Application Cache</em>.
The <em>Application Cache</em> in particular, makes day-to-day use of Niord substantially faster for end users.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Application Cache has supposedly been deprecated, and is to be replaced with a <em>Service Workers</em>
mechanism. However, Service Workers are not yet supported by Safari (read: iOS).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The niord-web project can be built using the "dist" profile:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cd niord-web
mvn -P dist clean install</pre>
</div>
</div>
<div class="paragraph">
<p>This will perform the following modifications to the resulting war file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All Niord CSS and JavaScript files will be merged into single files.</p>
</li>
<li>
<p>An HTML5 Application Cache manifest file is generated to facilitate caching.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="overlay-wars"><a class="anchor" href="#overlay-wars"></a><a class="link" href="#overlay-wars">3.3. Overlay Wars</a></h3>
<div class="paragraph">
<p>Another mightily important feature used by Niord, is the web-application overlay mechanism.</p>
</div>
<div class="paragraph">
<p>In reality, the Niord project would not be used in production by itself.
Rather, developers would create a country-specific version (such as niord-dk for Denmark,
or niord-gh for Ghana) with all the customizations and legacy integration needed for that
particular country.</p>
</div>
<div class="paragraph">
<p>The main trick is to create a web application that functions as an <em>overlay</em> of the Niord web application.
This allows the developer to selectively replace individual files, such as AngularJS files, CSS files,
resource bundles, etc.</p>
</div>
<div class="paragraph">
<p>The pom.xml file of the new web application, should define the overlay as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>maven-war-plugin<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>2.4<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;configuration&gt;</span>
        <span class="tag">&lt;workDirectory&gt;</span>target/overlay<span class="tag">&lt;/workDirectory&gt;</span>
        <span class="tag">&lt;overlays&gt;</span>
            <span class="tag">&lt;overlay&gt;</span>
                <span class="tag">&lt;groupId&gt;</span>org.niord<span class="tag">&lt;/groupId&gt;</span>
                <span class="tag">&lt;artifactId&gt;</span>niord-web<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;/overlay&gt;</span>
        <span class="tag">&lt;/overlays&gt;</span>
    <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="niord-development-set-up"><a class="anchor" href="#niord-development-set-up"></a><a class="link" href="#niord-development-set-up">4. Niord Development Set-Up</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>As described in the <a href="#Overlay Wars">[Overlay Wars]</a> section, a concrete implementation of the Niord system will almost
always involve a country-specific customized project, such as the
<a href="https://github.com/NiordOrg/niord-dk">niord-dk</a> project for Denmark, or the
<a href="https://github.com/GhanaNauticalnfo/niord-gh">niord-gh</a> project for Ghana.</p>
</div>
<div class="paragraph">
<p>The development setup described in this section will be based on <em>niord-dk</em>.</p>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/NiordOrg/niord-appsrv">niord-appsrv</a> project contains scripts for
setting up Wildfly, Keycloak, etc.
However, the easiest way to get started developing on the Niord project is to use Docker for the databases
and Keycloak. This is the set-up described below.</p>
</div>
<div class="sect2">
<h3 id="prerequisites"><a class="anchor" href="#prerequisites"></a><a class="link" href="#prerequisites">4.1. Prerequisites</a></h3>
<div class="ulist">
<ul>
<li>
<p>Java 8+</p>
</li>
<li>
<p>Maven</p>
</li>
<li>
<p>Docker</p>
</li>
<li>
<p>Docker Compose</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The set-up described in this section assumes that you are using Linux / MacOS X.
If you are using Windows, you will probably need to adjust the various commands and scripts
accordingly. Consider using Git Bash for the easiest migration.</p>
</div>
</div>
<div class="sect2">
<h3 id="check-out-niord-projects"><a class="anchor" href="#check-out-niord-projects"></a><a class="link" href="#check-out-niord-projects">4.2. Check out Niord Projects</a></h3>
<div class="paragraph">
<p>As mentioned, the development set-up used in this document is based on the Danish Niord project.</p>
</div>
<div class="paragraph">
<p>Either use your favorite IDE (assume IntelliJ) to check out the
<a href="https://github.com/NiordOrg/niord">niord</a> and
<a href="https://github.com/NiordOrg/niord-dk">niord-dk</a> projects, or check them out from the command line:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>git clone https://github.com/NiordOrg/niord.git
cd niord
mvn clean install
cd ..
git clone https://github.com/NiordOrg/niord-dk.git
cd niord-dk
mvn clean install</pre>
</div>
</div>
<div class="paragraph">
<p>The rest of the section will assume that you are working in the <em>niord-dk</em> directory.</p>
</div>
<div class="paragraph">
<p>Import the niord-dk project in IntelliJ via its pom.xml.
Under the "Maven Projects" also import the parent niord project. This will allow you to work and debug
both code-bases from within IntelliJ.</p>
</div>
<div class="paragraph">
<p>The first time around, IntelliJ may have created a new unversioned directory, <em>niord-dk-web/overlays</em>.
Just delete it and build again.</p>
</div>
</div>
<div class="sect2">
<h3 id="starting-mysql-and-keycloak"><a class="anchor" href="#starting-mysql-and-keycloak"></a><a class="link" href="#starting-mysql-and-keycloak">4.3. Starting MySQL and Keycloak</a></h3>
<div class="paragraph">
<p>Make sure your working directory is <em>niord-dk</em>.</p>
</div>
<div class="paragraph">
<p>You may want to start by creating a <strong>.env</strong> file in your working directory,
which overrides the environment variables (such as database passwords) used in the docker compose file.</p>
</div>
<div class="paragraph">
<p>The following commands will start two MySQL databases, one for the application server
and one for Keycloak, and also run Keycloak itself.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mkdir $HOME/.niord-dk
docker-compose -f dev/docker-dev-compose.yml pull
docker-compose -f dev/docker-dev-compose.yml up -d</pre>
</div>
</div>
<div class="paragraph">
<p>The initial <strong>mkdir</strong> command is just to avoid permission problems since docker would otherwise create it as owned
by root.</p>
</div>
<div class="paragraph">
<p>Once this is up and running, create a Keycloak admin user (default niordadmin/keycloak)
which can be used to create user groups and assign domain roles to the groups:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>./dev/keycloak-admin-user.sh</pre>
</div>
</div>
<div class="paragraph">
<p>Enter <a href="http://localhost:8090/auth/" class="bare">http://localhost:8090/auth/</a> and check that you can log in using the Keycloak admin user.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuring-wildfly"><a class="anchor" href="#configuring-wildfly"></a><a class="link" href="#configuring-wildfly">4.4. Configuring Wildfly</a></h3>
<div class="paragraph">
<p>Next, create and configure a Wildfly installation using:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>./dev/install-wildfly.sh</pre>
</div>
</div>
<div class="paragraph">
<p>Configure the Wildfly server in <em>IntelliJ</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Firstly, you may want to right-click the wildfly-10.1.0-Final folder and mark
the folder as excluded.</p>
</li>
<li>
<p>In Run &#8594; Edit configuration&#8230;&#8203;, configure a new local JBoss server based on the Wilfly
installation produced above.</p>
</li>
<li>
<p>Deploy "niord-dk-web:war exploded" to the server.</p>
</li>
<li>
<p>If you have only updated web resources, there is no need to re-deploy the web application. Use the "Update resources"
function instead.</p>
</li>
<li>
<p>To get rid of superfluous IntelliJ code editor warnings, disable the "Declaration access can be weaker"
and "Dangling Javadoc comment" inspections.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Keycloak docker image creates an initial domain, "Master", and a Niord user, sysadmin/sysadmin,
that should be used for the initial configuration of the system, whereupon they should be
deleted.</p>
</div>
<div class="paragraph">
<p>Enter <a href="http://localhost:8080" class="bare">http://localhost:8080</a> and check that you can log in using the Niord sysadmin user.</p>
</div>
</div>
<div class="sect2">
<h3 id="finishing-touches"><a class="anchor" href="#finishing-touches"></a><a class="link" href="#finishing-touches">4.5. Finishing touches</a></h3>
<div class="paragraph">
<p>Import the Danish test base data into Niord:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>./dev/install-base-data.sh</pre>
</div>
</div>
<div class="paragraph">
<p>Within a minute or so, this will import domains, areas, categories, etc. needed to run the Niord-DK project.
First clean up a bit:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In Niord, under Sysadmin &#8594; Domains, click the "Create in Keycloak" button for each of the imported domains.
This will create the two domains in Keycloak.</p>
</li>
<li>
<p>In Keycloak, edit the "Sysadmin" user group. Under "Role Mappings", select the clients created for the
imported domains one by one, and assign the "sysadmin" client roles to the group.</p>
</li>
<li>
<p>While in Keycloak, you may also want to define new user groups for <em>editors</em> and <em>admins</em>, and assign
the appropriate client roles for the imported domains to the groups.<br>
Additionally, for admin-related groups (who should be able to manage users in Niord), assign the
"manage-clients" and "manage-users" client roles of the "realm-management" client to the groups.</p>
</li>
<li>
<p>Delete the "Master" domain in Niord and the corresponding "niord-client-master" client in Keycloak.</p>
</li>
<li>
<p>Go through the configuration and settings of the Niord Sysadmin pages and adjust as
appropriate.</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="niord-proxy-development-set-up"><a class="anchor" href="#niord-proxy-development-set-up"></a><a class="link" href="#niord-proxy-development-set-up">5. Niord-Proxy Development Set-Up</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Niord-Proxy is a simple client-facing website that retrieves and renders messages from a
Niord back-end server.</p>
</div>
<div class="sect2">
<h3 id="prerequisites-2"><a class="anchor" href="#prerequisites-2"></a><a class="link" href="#prerequisites-2">5.1. Prerequisites</a></h3>
<div class="ulist">
<ul>
<li>
<p>Java 8+</p>
</li>
<li>
<p>Maven 3.x</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When setting up the development environment for the Niord-Proxy, you need to point it to an existing
Niord service, from where it will fetch data, i.e. the active messages and publications.</p>
</div>
<div class="paragraph">
<p>The set-up in this document will assume that you are running a development version of the Niord service,
as described in the <a href="#Niord Development Set-Up">[Niord Development Set-Up]</a> section.</p>
</div>
</div>
<div class="sect2">
<h3 id="check-out-niord-proxy-project"><a class="anchor" href="#check-out-niord-proxy-project"></a><a class="link" href="#check-out-niord-proxy-project">5.2. Check out Niord-Proxy Project</a></h3>
<div class="paragraph">
<p>Either use your favorite IDE (assume IntelliJ) to check out the
<a href="https://github.com/NiordOrg/niord-proxy">niord-proxy</a> project, or check it out from the command line:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>git clone https://github.com/NiordOrg/niord-proxy.git
cd niord-proxy</pre>
</div>
</div>
<div class="paragraph">
<p>Import the niord-proxy project in IntelliJ via its pom.xml.</p>
</div>
</div>
<div class="sect2">
<h3 id="starting-niord-proxy"><a class="anchor" href="#starting-niord-proxy"></a><a class="link" href="#starting-niord-proxy">5.3. Starting Niord-Proxy</a></h3>
<div class="paragraph">
<p>The Niord Proxy can be run as an executable jar:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mvn clean install
java -Dswarm.http.port=9000 \
    -Dniord-proxy.executionMode=DEVELOPMENT \
    -Dniord-proxy.server=http://localhost:8080 \
    -Dniord-proxy.repoType=SHARED \
    -Dniord-proxy.repoRootPath=/Users/carolus/.niord-dk/repo \
    -Dniord-proxy.timeZone=Europe/Copenhagen \
    -Dniord-proxy.areas="urn:mrn:iho:country:dk|56|11|6,urn:mrn:iho:country:gl|70|-40|4,urn:mrn:iho:country:fo|62|-7|8" \
    -Dniord-proxy.analyticsTrackingId= \
    -jar target/niord-proxy-swarm.jar</pre>
</div>
</div>
<div class="paragraph">
<p>An easier alternative is to run the <code>org.niord.proxy.NiordProxyMain</code> main class directly from your IDE
(e.g. IntelliJ). Use the same <em>VM Options</em> as for the executable jar above.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="niord-docker-containers"><a class="anchor" href="#niord-docker-containers"></a><a class="link" href="#niord-docker-containers">6. Niord Docker Containers</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The previous sections described how to set up and configure a Niord development environment,
which relied Docker containers for running MySQL and Keycloak.<br>
Docker containers is indeed a very flexible and convenient way of running Niord,
even in test and production.</p>
</div>
<div class="paragraph">
<p>This section will outline how to create and push docker containers for Niord. If you do not
rely on standard containers, please create your own Docker Hub at <a href="https://hub.docker.com" class="bare">https://hub.docker.com</a>, and
update the scripts and procedures accordingly.<br>
In particular, you will need to create a Docker Hub repo for your own customized <em>niord-appsrv</em>.</p>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/NiordOrg/niord-docker">niord-docker</a> repository contains a collection
of bash scripts for creating and pushing docker containers, which may be used for inspiration.</p>
</div>
<div class="sect2">
<h3 id="prerequisites-3"><a class="anchor" href="#prerequisites-3"></a><a class="link" href="#prerequisites-3">6.1. Prerequisites</a></h3>
<div class="paragraph">
<p>In order to build the projects and create docker containers, the following should be installed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java 8+</p>
</li>
<li>
<p>Maven</p>
</li>
<li>
<p>Docker</p>
</li>
<li>
<p>Docker Compose</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The set-up described in this section assumes that you are using Linux / MacOS X.
If you are using Windows, you will probably need to adjust the various commands and scripts
accordingly. Consider using Git Bash for the easiest migration.</p>
</div>
</div>
<div class="sect2">
<h3 id="checking-out-projects"><a class="anchor" href="#checking-out-projects"></a><a class="link" href="#checking-out-projects">6.2. Checking out Projects</a></h3>
<div class="paragraph">
<p>Assume that you have checked out the following projects, which is the Danish flavoured Niord system:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">git clone https://github.com/NiordOrg/niord.git
git clone https://github.com/NiordOrg/niord-dk.git
git clone https://github.com/NiordOrg/niord-proxy.git
git clone https://github.com/NiordOrg/niord-docker.git</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="building-projects"><a class="anchor" href="#building-projects"></a><a class="link" href="#building-projects">6.3. Building Projects</a></h3>
<div class="paragraph">
<p>A standard update script could execute the following updates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># Build niord project
cd niord
git pull
mvn clean install

# Build niord-dk project.
# NB: use the &quot;dist&quot; profile as this will merge JavaScripts and CSS files
#     into single files and enable support for HTML 5 App Cache.
cd ../niord-dk
git pull
mvn -P dist clean install

# Build niord-proxy project
cd ../niord-proxy
git pull
mvn clean install

# Update niord-docker
cd ../niord-docker
git pull</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="creating-docker-containers"><a class="anchor" href="#creating-docker-containers"></a><a class="link" href="#creating-docker-containers">6.4. Creating Docker Containers</a></h3>
<div class="paragraph">
<p>The example below demonstrates how to build some of the relevant docker containers.
Create your own versions of the scripts which points to your own Docker Hub organization
rather than <em>dmadk</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># log in to dockerhub in order to push the images
docker login

# Build niord-appsrv docker image
cd niord-docker/02-niord-appsrv/
./build-niord-appsrv.sh build ../../niord-dk/niord-dk-web/target/niord-dk-web.war
./build-niord-appsrv.sh push

# Build niord-keycloak docker image
cd ../03-niord-keycloak/
./build-niord-keycloak.sh build
./build-niord-keycloak.sh push

# Build niord-proxy docker image
cd ../06-niord-proxy/
./build-niord-proxy.sh build ../../niord-proxy/target/niord-proxy-swarm.jar
./build-niord-proxy.sh push</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="running-a-complete-niord-system"><a class="anchor" href="#running-a-complete-niord-system"></a><a class="link" href="#running-a-complete-niord-system">6.5. Running a Complete Niord System</a></h3>
<div class="paragraph">
<p>The following example will illustrate how to run a complete Niord system using Docker containers.</p>
</div>
<div class="paragraph">
<p>The example is based on the <em>GhanaNautical.info</em> project, which is a Ghana-flavoured version
of Niord, since this is a very self-contained set-up where everything is created within a single
Amazon WS account, ranging from an EC2 linux instance, the purchase of DNS names, generation
of SSL certificates, configuration of mail accounts, SMTP, etc.</p>
</div>
<div class="paragraph">
<p>Setting up and configuring Amazon WS is beyond the scope of this manual, which will merely focus
on how to run Niord as Docker-containers withing the Amazon WS infrastructure depicted below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/NiordGhanaInfrastructure.png" alt="Niord Ghana Infrastructure" width="800">
</div>
</div>
<div class="paragraph">
<p>In this set-up the $NIORD_HOME directory is situated at <code>/data/niord-gh</code>. An initial bootstrapping
settings file should be created at <code>/data/niord-gh/niord.json</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">[
  {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>         : <span class="string"><span class="delimiter">&quot;</span><span class="content">niord.home</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">The root directory for the Niord application</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>       : <span class="string"><span class="delimiter">&quot;</span><span class="content">/data/niord-gh</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">web</span><span class="delimiter">&quot;</span></span>         : <span class="value">false</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">editable</span><span class="delimiter">&quot;</span></span>    : <span class="value">true</span>
  },
  {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>         : <span class="string"><span class="delimiter">&quot;</span><span class="content">baseUri</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">The base application server URI</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>       : <span class="string"><span class="delimiter">&quot;</span><span class="content">https://niord.ghananautical.info</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">web</span><span class="delimiter">&quot;</span></span>         : <span class="value">false</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">editable</span><span class="delimiter">&quot;</span></span>    : <span class="value">true</span>
  },
  {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>         : <span class="string"><span class="delimiter">&quot;</span><span class="content">authServerUrl</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">The Keycloak URL</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>       : <span class="string"><span class="delimiter">&quot;</span><span class="content">https://niord-keycloak.ghananautical.info/auth</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">web</span><span class="delimiter">&quot;</span></span>         : <span class="value">false</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">editable</span><span class="delimiter">&quot;</span></span>    : <span class="value">true</span>
  },
  {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>         : <span class="string"><span class="delimiter">&quot;</span><span class="content">authServerSslRequired</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">Either 'external', 'none' or 'all'</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>       : <span class="string"><span class="delimiter">&quot;</span><span class="content">none</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">web</span><span class="delimiter">&quot;</span></span>         : <span class="value">false</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">editable</span><span class="delimiter">&quot;</span></span>    : <span class="value">true</span>
 },
 {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">mailSender</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">The sender e-mail address</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">niord@ghananautical.info</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">web</span><span class="delimiter">&quot;</span></span> : <span class="value">false</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">editable</span><span class="delimiter">&quot;</span></span> : <span class="value">true</span>
 },
 {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">mailValidRecipients</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">Comma-separated list of valid mail recipients, or 'ALL' for all recipients, or 'LOG' for simulation</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">ALL</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">web</span><span class="delimiter">&quot;</span></span> : <span class="value">false</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">editable</span><span class="delimiter">&quot;</span></span> : <span class="value">true</span>
 }
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, create a <code>.env</code> file in the working directory of the linux user. This should contain passwords
and settings for <em>docker-compose</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="conf">NIORD_HOME=/data/niord-gh
MYSQL_ROOT_PASSWORD=TBD
KCDB_PASSWORD=TBD
NIORDDB_PASSWORD=TBD
AMAZON_SES_USER=TBD
AMAZON_SES_PASSWORD=TBD
PROXY_TRACKING_ID=TBD</code></pre>
</div>
</div>
<div class="paragraph">
<p>Start the Niord system from the docker-compose file found in the
<a href="https://github.com/GhanaNauticalnfo/niord-gh">niord-gh</a> Github repository:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">git clone https://github.com/GhanaNauticalnfo/niord-gh.git
docker-compose -f niord-gh/docker/docker-test-compose.yml pull
docker-compose -f niord-gh/docker/docker-test-compose.yml up -d</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first time the Niord system is started, add a Keycloak admin user,
which can be used to create user groups and assign domain roles to the groups:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cd ~/niord-gh
./keycloak-admin-user.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, deploy the initial base data (charts, areas, domains, etc.) for the new installation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zip -j /tmp/niord-basedata.zip ~/niord-gh/niord-gh-basedata/*.json
sudo mkdir -p /data/niord-gh/batch-jobs/batch-sets/
sudo mv /tmp/niord-basedata.zip /data/niord-gh/batch-jobs/batch-sets/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Within a minute or so, this will import domains, areas, categories, etc., needed to run
the Niord Ghana project. First clean up a bit:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In Niord, under Sysadmin &#8594; Domains, click the "Create in Keycloak" button for
the "NW" and "NM" domains. This will create the two domains in Keycloak.</p>
</li>
<li>
<p>In Keycloak, edit the "Sysadmin" user group. Under "Role Mappings", select first
"niord-nw" then "niord-nm" and assign the "sysadmin" client roles to the group.</p>
</li>
<li>
<p>While in Keycloak, you may also want to define new user groups for editors and admins,
and assign the appropriate client roles for "niord-nw" and "niord-nm" to the groups.
Additionally, for admin-related groups (who should be able to manage users in Niord),
assign the "manage-clients" and "manage-users" client roles of the "realm-management"
client to the groups.</p>
</li>
<li>
<p>Delete the "Master" domain in Niord and the corresponding "niord-client-master" client in Keycloak.</p>
</li>
<li>
<p>Go through the configuration and settings of the Niord Sysadmin pages and adjust as appropriate.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Lastly, update the root crontab, using "sudo crontab -e", to call the niord-backup
docker script periodically:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">45 * * * * /usr/bin/docker exec niord-backup /hourly-backup.sh &gt;&gt; /data/niord-gh/backup/backup.log 2&gt;&amp;1
20 07 * * * /usr/bin/docker exec niord-backup /daily-backup.sh &gt;&gt; /data/niord-gh/backup/backup.log 2&gt;&amp;1</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-11-22 11:38:07 UTC
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>